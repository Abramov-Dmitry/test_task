# Сервис на микросервисной архитектуре
## Оглавление
### [Способ запуска](#способ-запуска)</br>
### [Описание](#Описание)</br>
### [Список url](#список-url)
* [mlflow](#mlflow)
* [Gradio](#gradio)
* [API](#api)
### [Curl](#curl)</br>
* [Сервис определения вероятности сердечных заболеваний](#сервис-определения-вероятности-сердечных-заболеваний)
* [Сервис прогнозирования температуры](#сервис-прогнозирования-температуры)
* [Общий сервис](#общий-сервис)
### [Использованные модели](#используемые-модели)</br>
### [Использованные данные](#использованные-данные)</br>
### [САМАЯ ВАЖНАЯ ЧАСТЬ В ЭТОМ ПРОЕКТЕ](#самая-важная-часть-в-этом-проекте)


## Способ запуска:
```sh
git clone 

cd test_task

docker compose up
```

## Описание
Сервис на основе полученных данных анализирует вероятность сердечного заболевания и строит прогноз температуры, на основе работы двух сервисов GigaChat делает описание полученных результатов. Также для каждого сервиса разработана демонстрационная страница с использованием gradio

## Список url
### mlflow 
http://localhost:5000
### Gradio
* Сервис определения вероятности сердечных заболеваний http://localhost:8000/gradio/classifier/
* Сервис прогнозирования температуры http://localhost:8000/gradio/forecaster/
* Общий сервис с Gigachat http://localhost:8000/gradio/rec/
### API
* Сервис определения вероятности сердечных заболеваний http://localhost:5001/api
* Сервис прогнозирования температуры http://localhost:5002/api
* Общий сервис с Gigachat http://localhost:5003/api

## Curl
### Сервис определения вероятности сердечных заболеваний
Запрос
```sh
curl -d '{"age": 42,"sex": 1,"trestbps": 120, "chol": 231, "fbs": 14,"thalach": 166, "exang": 100}' -H "Content-Type: application/json" -X POST http://localhost:5001/api
```

Результат:
```json
{
    "heart_risk":0.334
}
```

### Сервис прогнозирования температуры
Запрос
```sh
curl -d '{"steps": 12}' -H "Content-Type: application/json" -X POST http://localhost:5002/api
```

Результат:
```json
{
    "ds": ["2022-07-23","2022-07-30","2022-08-06","2022-08-13","2022-08-20","2022-08-27","2022-09-03","2022-09-10","2022-09-17","2022-09-24","2022-10-01","2022-10-08"],
    "yhat": [21,21,21,20,20,19,18,17,16,14,13,12]
}
```

### Общий сервис
Запрос
```sh
curl -d '{"age": 42,"sex": 1,"trestbps": 120, "chol": 231, "fbs": 14,"thalach": 166, "exang": 100, "steps": 12}' -H "Content-Type: application/json" -X POST http://localhost:5003/api
```

Результат
```json
{
    "chat_recommendation":"В течение следующих 12 недель температура будет меняться следующим образом:\n\n1 неделя: 21°C\n2 неделя: 21°C\n3 неделя: 21°C\n4 неделя: 20°C\n5 неделя: 20°C\n6 неделя: 19°C\n7 неделя: 18°C\n8 неделя: 17°C\n9 неделя: 16°C\n10 неделя: 14°C\n11 неделя: 13°C\n12 неделя: 12°C\n\nВероятность сердечного приступа у человека составляет 0.334. Если у человека высокий риск сердечного приступа, то ему следует быть готовым к возможному недомоганию. Если риск сердечного приступа низкий, то ему следует знать, что погода может резко поменяться.",
    "temp_frst":
        {
            "ds": ["2022-07-23","2022-07-30","2022-08-06","2022-08-13","2022-08-20","2022-08-27","2022-09-03","2022-09-10","2022-09-17","2022-09-24","2022-10-01","2022-10-08"],"yhat":[21,21,21,20,20,19,18,17,16,14,13,12]
        },
    "heart_risk":0.334
}
```

## Использованные модели
1. Prophet: прогнозирование температуры
2. RandomForest: Определение сердечного заболевания
3. GigaChat: описание результатов

## Использованные данные
1. Определение сердечного заболевания: https://www.kaggle.com/datasets/johnsmith88/heart-disease-dataset/data
2. Температура в Москве: ссылку на источник не нашел, скачал с какого-то сайта, поэтому прикрепляю ссылку на свой гугл диск: https://drive.google.com/drive/folders/1pA22xPrqI1ofXChqXxsFPPh0CyPgacyq?usp=sharing


## САМАЯ ВАЖНАЯ ЧАСТЬ В ЭТОМ ПРОЕКТЕ
Заранее спасибо за просмотр тех задания и за обратную связь :)